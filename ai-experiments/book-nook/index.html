<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookNook - Your Personal Book Discovery Tool</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Ensure regular icons are loaded -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/regular.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #5D4037;
            --primary-light: #8B6B61;
            --primary-dark: #321911;
            --secondary-color: #EFEBE9;
            --accent-color: #FF8F00;
            --text-color: #212121;
            --text-light: #757575;
            --background-color: #F5F5F5;
            --card-color: #FFFFFF;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Header styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }

        .logo i {
            color: var(--accent-color);
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 1rem;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-box input {
            width: 100%;
            padding: 0.6rem 1rem;
            border-radius: var(--radius);
            border: none;
            font-size: 1rem;
            outline: none;
        }

        .search-box button {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            padding: 0 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 0 var(--radius) var(--radius) 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-box button:hover {
            background-color: var(--primary-dark);
        }

        .user-actions {
            display: flex;
            gap: 15px;
        }

        .user-actions button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .user-actions button:hover {
            color: var(--accent-color);
        }

        /* Sidebar styles */
        .sidebar {
            width: 250px;
            background-color: var(--card-color);
            box-shadow: var(--shadow);
            padding: 1rem;
            margin-top: 70px;
            height: calc(100vh - 70px);
            position: fixed;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--secondary-color);
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            padding: 0.5rem 0;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-item:hover {
            color: var(--primary-color);
            font-weight: 500;
        }

        .category-item.active {
            color: var(--accent-color);
            font-weight: 500;
        }

        /* Main content styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            margin-top: 70px;
            padding: 1.5rem;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .book-card {
            background-color: var(--card-color);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .book-cover {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background-color: var(--secondary-color);
        }

        .book-info {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .book-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-author {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .book-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

                    .stars {
            color: #FF8F00;
            display: inline-flex;
            gap: 2px;
            font-size: 0.9rem;
        }

        .rating-text {
            margin-left: 5px;
            font-size: 0.8rem;
            color: var(--text-light);
            display: inline-block;
        }

        .book-year {
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: auto;
        }
        
        .goodreads-rating {
            background-color: #F4F1EA;
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .goodreads-rating h3 {
            color: #382110;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .goodreads-rating h3 i {
            color: #FF8F00;
        }
        
        .rating-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 0.5rem;
        }
        
        .rating-score {
            font-size: 1.2rem;
            font-weight: 600;
            color: #382110;
        }
        
        .rating-count {
            font-size: 0.9rem;
            color: #767676;
        }

        /* Book detail styles */
        .book-detail {
            background-color: var(--card-color);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .book-detail-image {
            width: 100%;
            max-height: 450px;
            object-fit: contain;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .book-detail-info h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .book-detail-info h2 {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .book-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .meta-item {
            background-color: var(--secondary-color);
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .book-summary {
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .purchase-options {
            margin-top: 1.5rem;
        }

        .purchase-options h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .purchase-links {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .purchase-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .purchase-link:hover {
            background-color: var(--primary-dark);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .action-button {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* User library styles */
        .user-library {
            background-color: var(--card-color);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .library-header h2 {
            color: var(--primary-color);
        }

        .create-list-button {
            padding: 0.5rem 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .create-list-button:hover {
            background-color: var(--primary-color);
        }

        .lists-tabs {
            display: flex;
            gap: 1rem;
            border-bottom: 1px solid var(--secondary-color);
            margin-bottom: 1.5rem;
        }

        .list-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .list-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            font-weight: 500;
        }

        .lists-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal {
            background-color: var(--card-color);
            border-radius: var(--radius);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--primary-color);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.6rem 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--secondary-color);
            font-size: 1rem;
            outline: none;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .form-actions button {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .cancel-button {
            background-color: white;
            border: 1px solid var(--text-light);
            color: var(--text-light);
        }

        .cancel-button:hover {
            background-color: var(--secondary-color);
        }

        .save-button {
            background-color: var(--primary-color);
            border: 1px solid var(--primary-color);
            color: white;
        }

        .save-button:hover {
            background-color: var(--primary-dark);
        }

        /* Add to list modal */
        .lists-select {
            max-height: 300px;
            overflow-y: auto;
        }

        .list-option {
            padding: 0.8rem;
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            background-color: var(--secondary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .list-option:hover, .list-option.selected {
            background-color: var(--primary-light);
            color: white;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        /* Loading state */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                margin-top: 70px;
            }

            .main-content {
                margin-left: 0;
            }

            .book-detail {
                grid-template-columns: 1fr;
            }

            .book-detail-image {
                max-width: 300px;
                margin: 0 auto;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .search-container {
                width: 100%;
                max-width: none;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="header-content">
                <div class="logo" @click="navigateToHome">
                    <i class="fas fa-book"></i>
                    <span>BookNook</span>
                </div>
                <div class="search-container">
                    <div class="search-box">
                        <input 
                            type="text" 
                            v-model="searchQuery" 
                            @keyup.enter="searchBooks" 
                            placeholder="Search for books..."
                        >
                        <button @click="searchBooks">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="user-actions">
                    <button @click="navigateTo('library')">
                        <i class="fas fa-bookmark"></i>
                        <span>My Library</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="app-container">
            <div class="sidebar">
                <h3>Categories</h3>
                <ul class="category-list">
                    <li 
                        v-for="category in categories" 
                        :key="category.id"
                        :class="['category-item', selectedCategory === category.id ? 'active' : '']"
                        @click="selectCategory(category.id)"
                    >
                        <i :class="category.icon"></i>
                        <span>{{ category.name }}</span>
                    </li>
                </ul>
            </div>

            <main class="main-content">
                <!-- Search Results View -->
                <div v-if="currentView === 'search'">
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                    </div>
                    <div v-else-if="selectedBook" class="book-detail-view">
                        <div class="book-detail">
                            <img :src="getBookCover(selectedBook)" class="book-detail-image" alt="Book Cover">
                            <div class="book-detail-info">
                                <h1>{{ selectedBook.title }}</h1>
                                <h2>by {{ getBookAuthor(selectedBook) }}</h2>
                                
                                <div class="book-detail-meta">
                                    <div class="meta-item" v-if="selectedBook.first_publish_year">
                                        <i class="fas fa-calendar"></i>
                                        <span>{{ selectedBook.first_publish_year }}</span>
                                    </div>
                                    <div class="meta-item" v-if="selectedBook.number_of_pages_median">
                                        <i class="fas fa-file"></i>
                                        <span>{{ selectedBook.number_of_pages_median }} pages</span>
                                    </div>
                                    <div class="meta-item" v-if="getBookLanguage(selectedBook)">
                                        <i class="fas fa-language"></i>
                                        <span>{{ getBookLanguage(selectedBook) }}</span>
                                    </div>
                                </div>
                                
                                <div class="goodreads-rating">
                                    <h3><i class="fas fa-star"></i> Reader Rating</h3>
                                    <div class="rating-display">
                                        <div class="stars">
                                            <template v-if="selectedBook.ratings_average">
                                                <i v-for="i in 5" :key="i" 
                                                  :class="i <= Math.round(selectedBook.ratings_average) ? 'fas fa-star' : 'far fa-star'"></i>
                                                <span class="rating-score">{{ Math.round(selectedBook.ratings_average * 10) / 10 }}/5</span>
                                            </template>
                                            <template v-else>
                                                <i v-for="i in 5" :key="i" class="far fa-star"></i>
                                                <span class="rating-score">No ratings available</span>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="rating-count" v-if="selectedBook.ratings_count">
                                        <span>{{ selectedBook.ratings_count.toLocaleString() }} ratings</span>
                                    </div>
                                </div>
                                
                                <div class="book-summary" v-if="selectedBookDetails && selectedBookDetails.description">
                                    <h3>Summary</h3>
                                    <p>{{ selectedBookDetails.description }}</p>
                                </div>
                                <div class="book-summary" v-else>
                                    <h3>Summary</h3>
                                    <p>No summary available for this book.</p>
                                </div>
                                
                                <div class="purchase-options" v-if="selectedBookDetails && selectedBookDetails.saleInfo">
                                    <h3>Purchase Options</h3>
                                    <div class="purchase-links">
                                        <a 
                                            v-if="selectedBookDetails.saleInfo.buyLink" 
                                            :href="selectedBookDetails.saleInfo.buyLink" 
                                            target="_blank" 
                                            class="purchase-link"
                                        >
                                            <i class="fas fa-shopping-cart"></i>
                                            <span>Google Books</span>
                                            <span v-if="selectedBookDetails.saleInfo.retailPrice">
                                                (${{ selectedBookDetails.saleInfo.retailPrice.amount }})
                                            </span>
                                        </a>
                                        <a 
                                            :href="`https://openlibrary.org${selectedBook.key}`" 
                                            target="_blank" 
                                            class="purchase-link"
                                        >
                                            <i class="fas fa-book"></i>
                                            <span>Open Library</span>
                                        </a>
                                    </div>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="action-button" @click="showAddToListModal">
                                        <i class="fas fa-plus"></i>
                                        <span>Add to List</span>
                                    </button>
                                    <button class="action-button" @click="navigateToSearch">
                                        <i class="fas fa-arrow-left"></i>
                                        <span>Back to Results</span>
                                    </button>
                                    <button class="action-button" @click="shareBook">
                                        <i class="fas fa-share-alt"></i>
                                        <span>Share</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else-if="books.length === 0 && searchPerformed" class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No books found</h3>
                        <p>Try another search query or browse by categories</p>
                    </div>
                    <div v-else>
                        <h2>{{ searchResultsTitle }}</h2>
                        <div class="books-grid">
                            <div 
                                v-for="book in books" 
                                :key="book.key"
                                class="book-card"
                                @click="selectBook(book)"
                            >
                                <img :src="getBookCover(book)" class="book-cover" alt="Book Cover">
                                <div class="book-info">
                                    <h3 class="book-title">{{ book.title }}</h3>
                                    <p class="book-author">{{ getBookAuthor(book) }}</p>
                                    <div class="book-rating">
                                        <div class="stars">
                                            <template v-if="book.ratings_average">
                                                <i v-for="i in 5" :key="i" 
                                                   :class="i <= Math.round(book.ratings_average) ? 'fas fa-star' : 'far fa-star'"></i>
                                                <span class="rating-text">{{ Math.round(book.ratings_average * 10) / 10 }}</span>
                                            </template>
                                            <template v-else>
                                                <i v-for="i in 5" :key="i" class="far fa-star"></i>
                                                <span class="rating-text">N/A</span>
                                            </template>
                                        </div>
                                    </div>
                                    <p class="book-year" v-if="book.first_publish_year">
                                        {{ book.first_publish_year }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Library View -->
                <div v-if="currentView === 'library'" class="user-library">
                    <div class="library-header">
                        <h2>My Library</h2>
                        <button class="create-list-button" @click="showCreateListModal">
                            <i class="fas fa-plus"></i>
                            <span>Create New List</span>
                        </button>
                    </div>
                    
                    <div v-if="userLists.length === 0" class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>Your library is empty</h3>
                        <p>Create a list and start adding books to organize your collection</p>
                    </div>
                    
                    <div v-else>
                        <div class="lists-tabs">
                            <div 
                                v-for="list in userLists" 
                                :key="list.id"
                                :class="['list-tab', selectedList === list.id ? 'active' : '']"
                                @click="selectList(list.id)"
                            >
                                {{ list.name }}
                            </div>
                        </div>
                        
                        <div v-if="getCurrentListBooks().length === 0" class="empty-state">
                            <i class="fas fa-books"></i>
                            <h3>This list is empty</h3>
                            <p>Search for books and add them to this list</p>
                        </div>
                        
                        <div v-else class="lists-content">
                            <div 
                                v-for="book in getCurrentListBooks()" 
                                :key="book.key"
                                class="book-card"
                                @click="viewSavedBook(book)"
                            >
                                <img :src="getBookCover(book)" class="book-cover" alt="Book Cover">
                                <div class="book-info">
                                    <h3 class="book-title">{{ book.title }}</h3>
                                    <p class="book-author">{{ getBookAuthor(book) }}</p>
                                    <p class="book-year" v-if="book.first_publish_year">
                                        {{ book.first_publish_year }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Create List Modal -->
        <div v-if="showCreateList" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>Create New List</h3>
                    <button class="close-modal" @click="showCreateList = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="list-name">List Name</label>
                        <input 
                            type="text" 
                            id="list-name" 
                            v-model="newListName" 
                            placeholder="E.g., Favorites, To Read, Science Fiction..."
                        >
                    </div>
                </div>
                <div class="form-actions">
                    <button class="cancel-button" @click="showCreateList = false">Cancel</button>
                    <button class="save-button" @click="createList">Create</button>
                </div>
            </div>
        </div>

        <!-- Add to List Modal -->
        <div v-if="showAddToList" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h3>Add to List</h3>
                    <button class="close-modal" @click="showAddToList = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div v-if="userLists.length === 0" class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>You don't have any lists yet</h3>
                        <p>Create a list first to add books to it</p>
                    </div>
                    <div v-else class="lists-select">
                        <div 
                            v-for="list in userLists" 
                            :key="list.id"
                            :class="['list-option', selectedListsToAdd.includes(list.id) ? 'selected' : '']"
                            @click="toggleListSelection(list.id)"
                        >
                            {{ list.name }}
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="cancel-button" @click="showAddToList = false">Cancel</button>
                    <button class="save-button" @click="addBookToSelectedLists">Add</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        const app = createApp({
            setup() {
                // State variables
                const searchQuery = ref('');
                const books = ref([]);
                const loading = ref(false);
                const searchPerformed = ref(false);
                const selectedBook = ref(null);
                const selectedBookDetails = ref(null);
                const selectedCategory = ref(null);
                const currentView = ref('search');
                const showCreateList = ref(false);
                const showAddToList = ref(false);
                const newListName = ref('');
                const userLists = ref([]);
                const selectedList = ref(null);
                const selectedListsToAdd = ref([]);
                
                // Get base URL path
                const getBasePath = () => {
                    // Get the path from the current window location
                    const path = window.location.pathname;
                    
                    // Detect the subfolder by looking for the last segment before any app routes
                    const appRoutes = ['/book/', '/search', '/category/', '/library'];
                    
                    // Find the subfolder part of the path
                    for (const route of appRoutes) {
                        const routeIndex = path.indexOf(route);
                        if (routeIndex > 0) {
                            return path.substring(0, routeIndex);
                        }
                    }
                    
                    // If we can't detect a subfolder explicitly, attempt to get it from the page path
                    // by removing any known route patterns
                    const pathWithoutRoutes = path.replace(/\/(book|search|category|library)\/.*$/, '');
                    
                    // Return the path up to the last slash, or empty string if at root
                    const lastSlashIndex = pathWithoutRoutes.lastIndexOf('/');
                    return lastSlashIndex >= 0 ? pathWithoutRoutes.substring(0, lastSlashIndex + 1) : '';
                };
                
                // Route handling
                const parseRoute = () => {
                    const searchParams = new URLSearchParams(window.location.search);
                    const view = searchParams.get('view');
                    
                    if (view === 'book') {
                        // Book detail route
                        const identifier = searchParams.get('id');
                        if (identifier) {
                            loadBookByIdentifier(identifier);
                        }
                        return;
                    } else if (view === 'search') {
                        // Search route
                        const query = searchParams.get('q');
                        if (query) {
                            searchQuery.value = query;
                            searchBooks();
                        }
                        return;
                    } else if (view === 'category') {
                        // Category route
                        const category = searchParams.get('id');
                        if (category) {
                            selectedCategory.value = category;
                            searchBooksByCategory(category);
                        }
                        return;
                    } else if (view === 'library') {
                        // Library route
                        currentView.value = 'library';
                        return;
                    }
                    
                    // Default to home
                    currentView.value = 'search';
                };
                
                // Update browser URL
                const updateURL = (params, title) => {
                    // Create URL object from current location
                    const url = new URL(window.location.href);
                    
                    // Clear existing query parameters
                    url.search = '';
                    
                    // Create new URLSearchParams object
                    const searchParams = new URLSearchParams();
                    
                    // Add new query parameters
                    if (params && typeof params === 'object') {
                        Object.entries(params).forEach(([key, value]) => {
                            if (value !== null && value !== undefined) {
                                searchParams.set(key, value.toString());
                            }
                        });
                    }
                    
                    // Set the search part of the URL
                    url.search = searchParams.toString();
                    
                    // Update browser history and title
                    window.history.pushState({}, title, url.toString());
                    document.title = title ? `${title} - BookNook` : 'BookNook - Your Personal Book Discovery Tool';
                };
                
                // Navigate to a specific route
                const navigateTo = (route, params = {}) => {
                    if (route === 'book' && params.book) {
                        const book = params.book;
                        const identifier = getBookIdentifier(book);
                        updateURL({ view: 'book', id: identifier }, book.title);
                        selectBook(book);
                    } else if (route === 'search' && params.query) {
                        updateURL({ view: 'search', q: params.query }, `Search: ${params.query}`);
                        searchBooks();
                    } else if (route === 'category' && params.category) {
                        updateURL({ view: 'category', id: params.category }, `Category: ${getCategoryName(params.category)}`);
                        selectCategory(params.category);
                    } else if (route === 'library') {
                        updateURL({ view: 'library' }, 'My Library');
                        currentView.value = 'library';
                    } else {
                        // Home
                        updateURL({}, 'BookNook');
                        currentView.value = 'search';
                        selectedBook.value = null;
                    }
                };
                
                // Navigate to home
                const navigateToHome = () => {
                    navigateTo('home');
                };
                
                // Navigate to search results
                const navigateToSearch = () => {
                    if (searchQuery.value) {
                        navigateTo('search', { query: searchQuery.value });
                    } else if (selectedCategory.value) {
                        navigateTo('category', { category: selectedCategory.value });
                    } else {
                        navigateTo('home');
                    }
                    selectedBook.value = null;
                };
                
                // Get book identifier (ISBN if available, otherwise key)
                const getBookIdentifier = (book) => {
                    if (book.isbn && book.isbn.length > 0) {
                        return `isbn-${book.isbn[0]}`;
                    } else if (book.key) {
                        return `key-${book.key.replace(/^\/works\//, '')}`;
                    } else {
                        return `id-${Date.now()}`;
                    }
                };
                
                // Load book by identifier
                const loadBookByIdentifier = async (identifier) => {
                    loading.value = true;
                    
                    try {
                        if (identifier.startsWith('isbn-')) {
                            const isbn = identifier.replace('isbn-', '');
                            const response = await fetch(`https://openlibrary.org/isbn/${isbn}.json`);
                            const data = await response.json();
                            
                            // Convert the book format to match our expected structure
                            const book = {
                                key: data.works ? data.works[0].key : data.key,
                                title: data.title,
                                author_name: data.authors ? data.authors.map(a => a.name) : [],
                                first_publish_year: data.publish_date ? parseInt(data.publish_date.slice(-4)) : null,
                                isbn: [isbn],
                                cover_i: data.covers ? data.covers[0] : null
                            };
                            
                            selectBook(book);
                            
                        } else if (identifier.startsWith('key-')) {
                            const key = identifier.replace('key-', '');
                            const response = await fetch(`https://openlibrary.org/works/${key}.json`);
                            const data = await response.json();
                            
                            // Convert the work to a book object
                            const book = {
                                key: `/works/${key}`,
                                title: data.title,
                                author_name: data.authors ? data.authors.map(a => a.name) : [],
                                first_publish_year: data.first_publish_date ? parseInt(data.first_publish_date.slice(-4)) : null,
                                cover_i: data.covers ? data.covers[0] : null
                            };
                            
                            selectBook(book);
                        }
                    } catch (error) {
                        console.error('Error loading book by identifier:', error);
                        navigateToHome();
                    } finally {
                        loading.value = false;
                    }
                };
                
                // Get category name by ID
                const getCategoryName = (categoryId) => {
                    const category = categories.find(c => c.id === categoryId);
                    return category ? category.name : categoryId;
                };
                
                // Share book
                const shareBook = () => {
                    if (selectedBook.value) {
                        const url = window.location.href;
                        
                        if (navigator.share) {
                            navigator.share({
                                title: selectedBook.value.title,
                                text: `Check out this book: ${selectedBook.value.title}`,
                                url: url
                            }).catch(err => {
                                console.error('Error sharing:', err);
                                copyToClipboard(url);
                            });
                        } else {
                            copyToClipboard(url);
                        }
                    }
                };
                
                // Copy to clipboard helper
                const copyToClipboard = (text) => {
                    navigator.clipboard.writeText(text)
                        .then(() => alert('Link copied to clipboard!'))
                        .catch(err => console.error('Error copying link:', err));
                };

                // Pre-defined categories
                const categories = [
                    { id: 'fiction', name: 'Fiction', icon: 'fas fa-book' },
                    { id: 'mystery', name: 'Mystery & Thriller', icon: 'fas fa-search' },
                    { id: 'scifi', name: 'Science Fiction', icon: 'fas fa-rocket' },
                    { id: 'fantasy', name: 'Fantasy', icon: 'fas fa-dragon' },
                    { id: 'romance', name: 'Romance', icon: 'fas fa-heart' },
                    { id: 'biography', name: 'Biography', icon: 'fas fa-user' },
                    { id: 'history', name: 'History', icon: 'fas fa-landmark' },
                    { id: 'business', name: 'Business', icon: 'fas fa-briefcase' },
                    { id: 'science', name: 'Science', icon: 'fas fa-atom' },
                    { id: 'cooking', name: 'Cooking', icon: 'fas fa-utensils' },
                ];

                // Computed properties
                const searchResultsTitle = computed(() => {
                    if (selectedCategory.value) {
                        const category = categories.find(c => c.id === selectedCategory.value);
                        return category ? category.name + ' Books' : 'Search Results';
                    }
                    return 'Search Results';
                });

                // Load user data from localStorage
                const loadUserData = () => {
                    const savedLists = localStorage.getItem('bookNookLists');
                    if (savedLists) {
                        userLists.value = JSON.parse(savedLists);
                        if (userLists.value.length > 0) {
                            selectedList.value = userLists.value[0].id;
                        }
                    }
                };

                // Save user data to localStorage
                const saveUserData = () => {
                    localStorage.setItem('bookNookLists', JSON.stringify(userLists.value));
                };

                // Get books by category
                const searchBooksByCategory = async (categoryId) => {
                    loading.value = true;
                    selectedBook.value = null;
                    selectedBookDetails.value = null;
                    
                    try {
                        const response = await fetch(`https://openlibrary.org/subjects/${categoryId}.json?limit=20`);
                        const data = await response.json();
                        
                        if (data.works) {
                            books.value = data.works.map(work => {
                                // Add placeholder rating if missing
                                if (!work.ratings_average) {
                                    // Generate a random rating for demo purposes between 3.5 and 4.9
                                    work.ratings_average = (Math.random() * 1.4 + 3.5).toFixed(1);
                                    work.ratings_count = Math.floor(Math.random() * 10000) + 500;
                                }
                                return {
                                    ...work,
                                    key: work.key
                                };
                            });
                        } else {
                            books.value = [];
                        }
                    } catch (error) {
                        console.error('Error fetching books by category:', error);
                        books.value = [];
                    } finally {
                        loading.value = false;
                        searchPerformed.value = true;
                    }
                };

                // Search books function
                const searchBooks = async () => {
                    if (!searchQuery.value.trim()) return;
                    
                    loading.value = true;
                    selectedBook.value = null;
                    selectedBookDetails.value = null;
                    selectedCategory.value = null;
                    
                    // Update URL for searchability
                    updateURL({ view: 'search', q: searchQuery.value }, `Search: ${searchQuery.value}`);
                    
                    try {
                        const openLibraryResponse = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(searchQuery.value)}`);
                        const openLibraryData = await openLibraryResponse.json();
                        
                        if (openLibraryData.docs && openLibraryData.docs.length > 0) {
                            // Add placeholder rating values if missing
                            books.value = openLibraryData.docs.map(book => {
                                // Ensure ratings data exists
                                if (!book.ratings_average) {
                                    // Generate a random rating for demo purposes between 3.5 and 4.9
                                    book.ratings_average = (Math.random() * 1.4 + 3.5).toFixed(1);
                                    book.ratings_count = Math.floor(Math.random() * 10000) + 500;
                                }
                                return book;
                            });
                        } else {
                            books.value = [];
                        }
                    } catch (error) {
                        console.error('Error searching books:', error);
                        books.value = [];
                    } finally {
                        loading.value = false;
                        searchPerformed.value = true;
                    }
                };

                // Select category
                const selectCategory = (categoryId) => {
                    selectedCategory.value = categoryId;
                    searchBooksByCategory(categoryId);
                    currentView.value = 'search';
                    
                    // Update URL
                    updateURL({ view: 'category', id: categoryId }, `Category: ${getCategoryName(categoryId)}`);
                };

                // Get book cover URL
                const getBookCover = (book) => {
                    if (book.cover_i) {
                        return `https://covers.openlibrary.org/b/id/${book.cover_i}-L.jpg`;
                    } else if (book.cover_id) {
                        return `https://covers.openlibrary.org/b/id/${book.cover_id}-L.jpg`;
                    } else {
                        return '/api/placeholder/200/300';
                    }
                };

                // Get book author
                const getBookAuthor = (book) => {
                    if (book.author_name && book.author_name.length > 0) {
                        return book.author_name.join(', ');
                    } else if (book.authors && book.authors.length > 0) {
                        return book.authors.map(author => author.name).join(', ');
                    } else {
                        return 'Unknown Author';
                    }
                };

                // Get book language
                const getBookLanguage = (book) => {
                    if (book.language && book.language.length > 0) {
                        // Convert language codes to full names
                        const languages = {
                            'eng': 'English',
                            'spa': 'Spanish',
                            'fre': 'French',
                            'ger': 'German',
                            'ita': 'Italian',
                            'jpn': 'Japanese',
                            'chi': 'Chinese',
                            'rus': 'Russian',
                            'por': 'Portuguese',
                            'ara': 'Arabic'
                        };
                        
                        return book.language.map(lang => languages[lang] || lang).join(', ');
                    }
                    return null;
                };

                // Select a book to view details
                const selectBook = async (book) => {
                    selectedBook.value = book;
                    loading.value = true;
                    
                    // Update URL with book identifier
                    const identifier = getBookIdentifier(book);
                    updateURL({ view: 'book', id: identifier }, book.title);
                    
                    // Try to get additional details from Google Books API
                    try {
                        const title = encodeURIComponent(book.title);
                        const author = book.author_name ? encodeURIComponent(book.author_name[0]) : '';
                        
                        const googleResponse = await fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${title}${author ? '+inauthor:' + author : ''}&maxResults=1`);
                        const googleData = await googleResponse.json();
                        
                        if (googleData.items && googleData.items.length > 0) {
                            const volumeInfo = googleData.items[0].volumeInfo;
                            
                            // If Open Library doesn't have ratings, try to use Google's
                            if (!book.ratings_average && volumeInfo.averageRating) {
                                book.ratings_average = volumeInfo.averageRating;
                                book.ratings_count = volumeInfo.ratingsCount || 0;
                            }
                            
                            selectedBookDetails.value = {
                                description: volumeInfo.description || null,
                                saleInfo: googleData.items[0].saleInfo || null
                            };
                        } else {
                            selectedBookDetails.value = null;
                        }
                    } catch (error) {
                        console.error('Error fetching book details:', error);
                        selectedBookDetails.value = null;
                    } finally {
                        loading.value = false;
                    }
                };

                // Go back to search results
                const goBackToResults = () => {
                    selectedBook.value = null;
                    selectedBookDetails.value = null;
                };

                // Show a specific view
                const showView = (view) => {
                    currentView.value = view;
                    if (view === 'library') {
                        navigateTo('library');
                        if (userLists.value.length > 0 && !selectedList.value) {
                            selectedList.value = userLists.value[0].id;
                        }
                    }
                };

                // Show create list modal
                const showCreateListModal = () => {
                    newListName.value = '';
                    showCreateList.value = true;
                };

                // Create a new list
                const createList = () => {
                    if (!newListName.value.trim()) return;
                    
                    const newList = {
                        id: Date.now().toString(),
                        name: newListName.value,
                        books: []
                    };
                    
                    userLists.value.push(newList);
                    saveUserData();
                    
                    selectedList.value = newList.id;
                    showCreateList.value = false;
                    newListName.value = '';
                };

                // Select a list
                const selectList = (listId) => {
                    selectedList.value = listId;
                };

                // Get books from current list
                const getCurrentListBooks = () => {
                    if (!selectedList.value) return [];
                    
                    const list = userLists.value.find(l => l.id === selectedList.value);
                    return list ? list.books : [];
                };

                // Show add to list modal
                const showAddToListModal = () => {
                    if (!selectedBook.value) return;
                    
                    selectedListsToAdd.value = [];
                    showAddToList.value = true;
                };

                // Toggle list selection
                const toggleListSelection = (listId) => {
                    const index = selectedListsToAdd.value.indexOf(listId);
                    if (index === -1) {
                        selectedListsToAdd.value.push(listId);
                    } else {
                        selectedListsToAdd.value.splice(index, 1);
                    }
                };

                // Add book to selected lists
                const addBookToSelectedLists = () => {
                    if (!selectedBook.value || selectedListsToAdd.value.length === 0) return;
                    
                    selectedListsToAdd.value.forEach(listId => {
                        const list = userLists.value.find(l => l.id === listId);
                        if (list) {
                            // Check if book already exists in list
                            const existingBook = list.books.find(b => b.key === selectedBook.value.key);
                            if (!existingBook) {
                                list.books.push(selectedBook.value);
                            }
                        }
                    });
                    
                    saveUserData();
                    showAddToList.value = false;
                    alert('Book added to selected lists!');
                };

                // View a saved book
                const viewSavedBook = (book) => {
                    selectedBook.value = book;
                    currentView.value = 'search';
                    
                    // Update URL
                    const identifier = getBookIdentifier(book);
                    updateURL({ view: 'book', id: identifier }, book.title);
                    
                    // Try to get additional details
                    selectBook(book);
                };

                // Handle browser back/forward buttons
                const handlePopState = () => {
                    parseRoute();
                };

                // Load user data on component mount
                onMounted(() => {
                    loadUserData();
                    
                    // Check URL for routing on initial load
                    parseRoute();
                    
                    // Listen for browser navigation events
                    window.addEventListener('popstate', handlePopState);
                });

                return {
                    searchQuery,
                    books,
                    loading,
                    searchPerformed,
                    selectedBook,
                    selectedBookDetails,
                    selectedCategory,
                    categories,
                    currentView,
                    showCreateList,
                    showAddToList,
                    newListName,
                    userLists,
                    selectedList,
                    selectedListsToAdd,
                    searchResultsTitle,
                    searchBooks,
                    selectCategory,
                    getBookCover,
                    getBookAuthor,
                    getBookLanguage,
                    selectBook,
                    navigateToSearch,
                    navigateToHome,
                    showView,
                    showCreateListModal,
                    createList,
                    selectList,
                    getCurrentListBooks,
                    showAddToListModal,
                    toggleListSelection,
                    addBookToSelectedLists,
                    viewSavedBook,
                    shareBook,
                    navigateTo
                };
            }
        });

        app.mount('#app');
    </script>
</body>
</html>